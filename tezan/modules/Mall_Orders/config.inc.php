<?php/** * securitycheck:1表示不进行权限校验 */$Create = false;$Delete = true;$ExportExcel = true;$actionmapping = array (	array('actionname' => 'compulsion','securitycheck' => '1','type'=>'button','location'=>'bottom','func'=>'check_compulsion'),  //  array('actionname' => 'fastreturn','securitycheck' => '1','type'=>'button','location'=>'bottom','func'=>'check_fastreturn'),//	array('actionname' => 'Accepted','securitycheck' => '1','type'=>'listview','button'=>'<a  mask="true" class="add"  href="index.php?module=Orders&action=Accepted" title="提示信息" height="250" width="470" posttype="string" rel="ids" mode="dialog" target="selectedTodo"><span>确认订单</span></a>'),	//array('actionname' => 'ExportExcel','securitycheck' => '1','type'=>'listview','button'=>'<a href="index.php?module=Mall_Orders&action=SheetExportExcel&opr=checkstutas" class="icon"  posttype="string" rel="ids" target="selectedTodo" title="确定导出选中记录到Excel文件吗?"><span>导出选中记录到Excel</span></a>'),    array('actionname' => 'specialSheetExportExcel','securitycheck' => '1','type'=>'listview','func'=>'check_specialSheetExportExcel'),    array('actionname' => 'OrdersProducts','securitycheck' => '1','type'=>'ajax','location'=>'top','sequence'=>'1'),    //array('actionname' => 'printbill','securitycheck' => '1','type'=>'button','func'=>'check_printbill'),	array('actionname' => 'MyInvoice','securitycheck' => '1','type'=>'button','func'=>'check_myinvoice'),	array('actionname' => 'MyInvoicePrint','securitycheck' => '1','type'=>'button','func'=>'check_myinvoiceprint'),	array('actionname' => 'Invoice','securitycheck' => '1','type'=>'button','func'=>'check_Invoice'),    array('actionname' => 'invoicenumber','securitycheck' => '1','type'=>'button','func'=>'check_Invoicenumber'),	array('actionname' => 'LogisticsInfo','securitycheck' => '1','type'=>'ajax','location'=>'bottom','func'=>'check_Logistics'),	array('actionname' => 'Memo','securitycheck' => '1','type'=>'ajax','location'=>'bottom'),    /*array('actionname' => 'MassPrint','securitycheck' => '1','type'=>'listview','func'=>'check_massprint'),    array('actionname' => 'importLogistics','securitycheck' => '1','type'=>'listview','func'=>'check_importLogistics')*/);/*global  $supplierid,$supplierusertype;if (isset($supplierid) && $supplierid != ""){	try{		$supplier_info = XN_content::load($supplierid,"suppliers");		if ($supplier_info->my->suppliertype == 'B2B')		{			$actionmapping[] = array('actionname' => 'OfflinePayment','securitycheck' => '1','func'=>'OfflinePayment','type'=>'listview');		}	}    catch (XN_Exception $e)    {    }	}if(!function_exists('OfflinePayment')){	function OfflinePayment(){        global $current_user,$supplierid,$supplierusertype;        if (isset($supplierid) && $supplierid != "" )            return '<a href="index.php?module=Mall_Orders&action=OfflinePayment&opr=checkstutas" data-title="线下支付" data-id="edit" class="btn btn-default" data-group="ids" data-icon="edit" data-toggle="doajaxchecked" data-dialog=true><span>线下支付</span></a>';        else            return "";			}}*/if (!function_exists('check_importLogistics')) {    function check_importLogistics() {        return '<a class="btn btn-default" data-title="物流信息导入" data-mask="true" data-toggle="dialog" data-width="540" data-height="310" href="index.php?module=Mall_Orders&action=importLogistics"><span>物流信息导入</span></a>';    }}if (!function_exists('check_specialSheetExportExcel')) {    function check_specialSheetExportExcel() {        global $current_user;        if(is_admin($current_user)){            return '<a href="index.php?module=Mall_Orders&action=specialSheetExportExcel&opr=checkstutas" data-id="edit" class="btn btn-default" data-group="ids" data-icon="edit" data-toggle="doajaxchecked" data-dialog=true data-title="超级导出"><span>超级导出</span></a>';        }    }}if (!function_exists('check_Invoice')) {	function check_Invoice($module,$focus) {        global  $supplierid,$supplierusertype;		global $current_user;		if ($focus->mode == 'edit' && $_SESSION['vendorid'] == '' && ($focus->column_fields["supplierid"]==$supplierid || is_admin($current_user)))		{			if($focus->column_fields['order_status'] == '已付款'){                return '<a class="btn btn-default" data-icon="plane" data-title="发货" data-mask="true" data-toggle="dialog" data-width="600" data-height="400" href="index.php?module=Mall_Orders&action=Invoice&record='.$focus->id.'"><span>发货</span></a>';           				//return '<button type="submit" style="display:block;" class="btn btn-default" onclick="$(\'#savetype\').val(\'Invoice\');" >确认发货</button>';			}else{				return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" > 发货</a>';			}		}		else		{			return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" > 发货</a>';		}	}}if (!function_exists('check_printbill')) {    function check_printbill($module,$focus) {        if ($focus->mode == 'edit')        {            if($focus->column_fields['order_status'] == '已付款'){                return '<a class="btn btn-default" data-icon="print" data-title="打印发货单" data-mask="true" data-toggle="dialog" data-width="1024" data-height="700" href="index.php?module=Mall_Orders&action=printbill&record='.$focus->id.'"><span>打印发货单</span></a>';            }else{                return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" > 打印发货单</a>';            }        }        else        {            return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" > 打印发货单</a>';        }    }}if (!function_exists('check_myinvoice')) {    function check_myinvoice($module,$focus) {        if ($focus->mode == 'edit' && $_SESSION['vendorid'] == '')        {			global  $supplierid;			$mall_settings = XN_Query::create ( 'Content' )->tag("mall_settings")			            ->filter("type","=","mall_settings") 			            ->filter("my.deleted",'=','0')			            ->filter("my.supplierid",'=',$supplierid)			            ->end(1)			            ->execute();			if (count($mall_settings) > 0)			{				$mall_setting_info = $mall_settings[0];				$mylogistic = $mall_setting_info->my->mylogistic; //自有物流 				$mylogisticname = $mall_setting_info->my->mylogisticname; // 自有物流名称				if ($mylogistic == '1')				{		            if($focus->column_fields['order_status'] == '已付款'){		                return '<a class="btn btn-default" data-icon="plane" data-title="'.$mylogisticname.'发货" data-mask="true" data-toggle="dialog" data-width="500" data-height="250" href="index.php?module=Mall_Orders&action=MyInvoice&record='.$focus->id.'"><span>'.$mylogisticname.'发货</span></a>';		            }else{		                return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" >'.$mylogisticname.'发货</a>';		            }				} 			}                   }     }}if (!function_exists('check_myinvoiceprint')) {    function check_myinvoiceprint($module,$focus) {        if ($focus->mode == 'edit' && $_SESSION['vendorid'] == '')        {			global  $supplierid;			$mall_settings = XN_Query::create ( 'Content' )->tag("mall_settings")			            ->filter("type","=","mall_settings") 			            ->filter("my.deleted",'=','0')			            ->filter("my.supplierid",'=',$supplierid)			            ->end(1)			            ->execute();			if (count($mall_settings) > 0)			{				$mall_setting_info = $mall_settings[0];				$mylogistic = $mall_setting_info->my->mylogistic; //自有物流 				$mylogisticname = $mall_setting_info->my->mylogisticname; // 自有物流名称				if ($mylogistic == '1')				{					$logistics = XN_Query::create("Content")->tag("logistics")			            ->filter("type","eic",'logistics')			            ->filter("my.deleted","=","0")			            ->filter("my.logisticsname","=",$mylogisticname)			            ->end(1)			            ->execute();					if (count($logistics) > 0)					{						$logistic_info = $logistics[0];						$logisticid = $logistic_info->id;						if($focus->column_fields['order_status'] == '已发货' && $focus->column_fields['delivery'] == $logisticid)						{			                return '<a class="btn btn-default" data-icon="print" data-title="打印'.$mylogisticname.'发货单" href="javascript:;"  onclick="myinvoiceprint(\''.$focus->id.'\');"><span>打印'.$mylogisticname.'发货单</span></a>';			            }			            else			            {			                return '<a disabled class="btn btn-default" data-icon="print" href="javascript:;" >打印'.$mylogisticname.'发货单</a>';			            }					} 				 				} 			}                   }     }}if (!function_exists('check_Invoicenumber')) {    function check_Invoicenumber($module,$focus) {        global $current_user;        global  $supplierid,$supplierusertype;        if ($focus->mode == 'edit' && (check_authorize('tezanadmin')||is_admin($current_user) || $focus->column_fields['supplierid']==$supplierid))        {            if($focus->column_fields['order_status'] == '已发货'){                return '<a class="btn btn-default" data-title="修改发货信息" data-icon="edit" data-mask="true" data-toggle="dialog" data-width="550" data-height="250" href="index.php?module=Mall_Orders&action=UpdateInvoiceNumber&record='.$focus->id.'"><span>修改物流</span></a>';            }else{                return '';            }        }        else        {            return '';        }    }}if (!function_exists('check_massprint')) {    function check_massprint() {        return '<a class="btn btn-default" data-title="批量打印快递单" data-height="300" data-width="600" data-group="ids" data-icon="edit" data-toggle="doajaxchecked" data-dialog=true href="index.php?module=Mall_Orders&action=MassPrint&mode=selectlogistic"><span>批量打印快递单</span></a>';    }}if (!function_exists('check_Logistics')) {	function check_Logistics($module,$focus) {		$info['visible'] = false;		if ($focus->mode == 'edit') 		{			if($focus->column_fields['delivery'] != '' && $focus->column_fields['invoicenumber'] != ""){				$info['visible'] = true;			}		}		return $info;	}} if (!function_exists('check_fastreturn')) {    function check_fastreturn($module,$focus) { 		$order_status = $focus->column_fields['order_status'];		$settlementstatus = $focus->column_fields['settlementstatus'];        global $current_user;        global  $supplierid,$supplierusertype;        if($supplierusertype == "boss" && $settlementstatus == "0")		{ 			if( $order_status == '已发货' || $order_status == '已付款' || $order_status == '确认收货'){            	return '<a class="btn btn-default"  data-icon="edit"  data-title="退货退款" data-mask="true" data-toggle="dialog" data-width="700" data-height="410" href="index.php?module=Mall_Orders&action=fastreturn&record='.$focus->id.'"><span>退货退款</span></a>';		   }        }         return false;     }}if (!function_exists('check_compulsion')) {	function check_compulsion($module,$focus) {        global $current_user;        global  $supplierid,$supplierusertype;		if ($supplierusertype == "boss" && $focus->column_fields['returnedgoodsstatus'] != "yes")  		{ 			if($focus->column_fields['order_status'] != "退货中" && $focus->column_fields['order_status'] != "待付款")			{                 return '<a class="btn btn-default"  data-icon="edit" data-title="强行退货" data-mask="true" data-toggle="dialog" data-width="570" data-height="270" href="index.php?module=Mall_Orders&action=compulsion&submittype=responsibility&orderid='.$focus->id.'"><span>强行退货</span></a>';			}        }         return false; 			}}?>