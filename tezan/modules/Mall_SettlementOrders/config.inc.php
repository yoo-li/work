<?php/** * securitycheck:1表示不进行权限校验 */$Create = false;$Delete = false;$ExportExcel = true;$actionmapping = array (	array('actionname' => 'Invoice','securitycheck' => '1','type'=>'button','func'=>'check_Invoice'),	array('actionname' => 'invoicenumber','securitycheck' => '1','type'=>'button','func'=>'check_Invoicenumber'),	array('actionname' => 'Memo','securitycheck' => '1','type'=>'ajax','location'=>'bottom'),	array('actionname' => 'SubmitSettlement','securitycheck' => '1','func'=>'SubmitSettlement','type'=>'listview'),	array('actionname' => 'MyInvoice','securitycheck' => '1','type'=>'button','func'=>'check_myinvoice'),	array('actionname' => 'MyInvoicePrint','securitycheck' => '1','type'=>'button','func'=>'check_myinvoiceprint'),	array('actionname' => 'LogisticsInfo','securitycheck' => '1','type'=>'ajax','location'=>'bottom','func'=>'check_Logistics'),	array ('actionname' => 'PrintSortingOrder','securitycheck' => '1','type'=>'listview','func'=>'check_printsortingorder'),	array ('actionname' => 'PrintLogisticStatistics','securitycheck' => '1','type'=>'listview','func'=>'check_printlogisticstatistics'),		);if (!function_exists('check_printsortingorder')) {	function check_printsortingorder() {		if ($_SESSION['vendorid'] != '')		{            return '<a href="index.php?module=Mall_SettlementOrders&action=PrintSortingOrder&oper=view"  data-title="打印拣货对账单" data-height="600" data-width="800" data-group="ids"  data-toggle="doajaxchecked" data-dialog=true class="btn btn-default">打印拣货对账单</a>';		}	 }}if (!function_exists('check_printlogisticstatistics')) {	function check_printlogisticstatistics() {		if ($_SESSION['vendorid'] != '')		{  		  return '<a data-title="请选择线路" data-fresh="false" data-group="ids" data-height="300" data-width="400"  data-mask="true" data-toggle="doajaxchecked" data-dialog=true href="index.php?module=Mall_SettlementOrders&amp;action=SelectDriver&amp;oper=view"   class="btn btn-default">打印物流揽件对账单</a>';					}	 }} if (!function_exists('check_Logistics')) {	function check_Logistics($module,$focus) {		$info['visible'] = false;		if ($focus->mode == 'edit') 		{			if($focus->column_fields['delivery'] != '' && $focus->column_fields['invoicenumber'] != ""){				$info['visible'] = true;			}		}		return $info;	}}if (!function_exists('check_myinvoice')) {    function check_myinvoice($module,$focus) {        if ($focus->mode == 'edit' && $_SESSION['vendorid'] != '')        {			global  $supplierid;			$mall_settings = XN_Query::create ( 'Content' )->tag("mall_settings")			            ->filter("type","=","mall_settings") 			            ->filter("my.deleted",'=','0')			            ->filter("my.supplierid",'=',$supplierid)			            ->end(1)			            ->execute();			if (count($mall_settings) > 0)			{				$mall_setting_info = $mall_settings[0];				$mylogistic = $mall_setting_info->my->mylogistic; //自有物流 				$mylogisticname = $mall_setting_info->my->mylogisticname; // 自有物流名称				if ($mylogistic == '1')				{		            if($focus->column_fields['mall_settlementordersstatus'] == '待发货'){		                return '<a class="btn btn-default" data-icon="plane" data-title="'.$mylogisticname.'发货" data-mask="true" data-toggle="dialog" data-width="500" data-height="250" href="index.php?module=Mall_SettlementOrders&action=MyInvoice&record='.$focus->id.'"><span>'.$mylogisticname.'发货</span></a>';		            }else{		                return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" >'.$mylogisticname.'发货</a>';		            }				} 			}                   }     }}if (!function_exists('check_myinvoiceprint')) {    function check_myinvoiceprint($module,$focus) {        if ($focus->mode == 'edit'  && $_SESSION['vendorid'] != '')        {			global  $supplierid;			$mall_settings = XN_Query::create ( 'Content' )->tag("mall_settings")			            ->filter("type","=","mall_settings") 			            ->filter("my.deleted",'=','0')			            ->filter("my.supplierid",'=',$supplierid)			            ->end(1)			            ->execute();			if (count($mall_settings) > 0)			{				$mall_setting_info = $mall_settings[0];				$mylogistic = $mall_setting_info->my->mylogistic; //自有物流 				$mylogisticname = $mall_setting_info->my->mylogisticname; // 自有物流名称				if ($mylogistic == '1')				{					$logistics = XN_Query::create("Content")->tag("logistics")			            ->filter("type","eic",'logistics')			            ->filter("my.deleted","=","0")			            ->filter("my.logisticsname","=",$mylogisticname)			            ->end(1)			            ->execute();					if (count($logistics) > 0)					{						$logistic_info = $logistics[0];						$logisticid = $logistic_info->id;						if($focus->column_fields['mall_settlementordersstatus'] == '已发货' && $focus->column_fields['delivery'] == $logisticid)						{			                return '<a class="btn btn-default" data-icon="print" data-title="打印'.$mylogisticname.'发货单" href="javascript:;"  onclick="settlementorders_invoiceprint(\''.$focus->id.'\');"><span>打印'.$mylogisticname.'发货单</span></a>';			            }			            else			            {			                return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" >打印'.$mylogisticname.'发货单</a>';			            }					} 				 				} 			}                   }     }}if (!function_exists('SubmitSettlement')) {    function SubmitSettlement(){        global $current_user,$supplierid,$supplierusertype;        if (isset($supplierid) && $supplierid != '')            return '<a href="index.php?module=Mall_SettlementOrders&action=SubmitSettlement" data-title="提交结算" data-height="200" data-width="440" data-id="edit" class="btn btn-default" data-group="ids" data-icon="edit" data-toggle="doajaxchecked" data-dialog=true><span>提交结算</span></a>';        else            return "";    }}if (!function_exists('check_Invoice')) {	function check_Invoice($module,$focus) {        global  $supplierid,$supplierusertype;		global $current_user;		$vendorsettlementstatus = $focus->column_fields['vendorsettlementstatus']; 		if ($focus->mode == 'edit' &&  isset($supplierid) && $supplierid != "" && $vendorsettlementstatus != "4" && $vendorsettlementstatus != "5")		{			if($focus->column_fields['deliverystatus'] == '0' && $focus->column_fields['vendortradestatus'] == '0'){				return '<a data-icon="plane" data-fresh="false" data-height="240"  data-mask="true" data-toggle="dialog" href="index.php?module=Mall_SettlementOrders&amp;action=Invoice&amp;record='.$focus->id.'" class="btn btn-default" ><span>发货</span></a>';			}else{				return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" > 发货</a>';			}		}		else		{			return '<a disabled class="btn btn-default" data-icon="lock" href="javascript:;" > 发货</a>';		}	}} if (!function_exists('check_Invoicenumber')) {    function check_Invoicenumber($module,$focus) {        global $current_user;        global  $supplierid,$supplierusertype;         if ($focus->mode == 'edit' &&  isset($supplierid) && $supplierid != "")        {            if($focus->column_fields['deliverystatus'] == '1' && $focus->column_fields['vendortradestatus'] == '0'){                return '<a class="btn btn-default" data-icon="edit"  data-title="修改发货信息" data-mask="true" data-toggle="dialog" data-height="240" href="index.php?module=Mall_SettlementOrders&amp;action=Invoice&amp;record='.$focus->id.'"><span>修改物流</span></a>';            }else{                return '';            }        }        else        {            return '';        }    }} ?>